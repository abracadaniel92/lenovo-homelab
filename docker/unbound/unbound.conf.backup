# Unbound DNS Resolver Configuration
# This config makes Unbound a recursive DNS resolver that queries root servers directly
# Pi-hole will forward DNS queries to Unbound on port 5335

server:
    # Listen on localhost only (port 5335 to avoid conflict with Pi-hole on port 53)
    interface: 127.0.0.1@5335
    ip-freebind: yes
    
    # Enable IPv4 and IPv6 (Unbound can do recursive queries for both)
    do-ip4: yes
    do-ip6: no  # Disable IPv6 if your network doesn't use it
    do-udp: yes
    do-tcp: yes
    
    # Security and privacy
    hide-identity: yes
    hide-version: yes
    
    # Performance optimizations
    num-threads: 2  # 2 threads for Pi 4 (adjust based on CPU cores)
    so-reuseport: yes
    # Reduced buffer sizes for Pi (warnings are non-fatal, but smaller is better)
    # so-rcvbuf: 4m
    # so-sndbuf: 4m
    
    # Cache settings
    cache-min-ttl: 3600
    cache-max-ttl: 86400
    prefetch: yes
    prefetch-key: yes
    
    # Recursive query settings
    qname-minimisation: yes
    aggressive-nsec: yes
    
    # Access control - only allow from localhost (Pi-hole)
    access-control: 127.0.0.0/8 allow
    
    # Root hints - Unbound has built-in root hints, no need to specify file
    # root-hints: "/usr/share/dns/root.hints"  # Commented out - built-in hints work fine
    
    # Local data (optional - for local domain resolution)
    # local-zone: "local" static
    # local-data: "test.local. A 192.168.1.100"

# Python module (uncomment if needed for advanced features)
# python:

# Remote control (uncomment if you want to use unbound-control)
# remote-control:
#     control-enable: no
#     control-interface: 127.0.0.1
#     control-port: 8953
#     server-key-file: "/etc/unbound/unbound_server.key"
#     server-cert-file: "/etc/unbound/unbound_server.pem"

