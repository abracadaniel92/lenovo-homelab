# Cloudflare Tunnel with High Availability
# Uses Docker replicas for redundancy - if one instance crashes, others continue
# Uses host network so 127.0.0.1 reaches host services

services:
  cloudflared:
    image: cloudflare/cloudflared:latest
    restart: always
    network_mode: host  # Use host network so 127.0.0.1 works
    command: tunnel --config /home/goce/.cloudflared/config.yml run
    volumes:
      - /home/goce/.cloudflared:/home/goce/.cloudflared:ro
    deploy:
      mode: replicated
      replicas: 2  # Run 2 instances for redundancy
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 0  # Unlimited restart attempts
        window: 60s

