{
	email contact@gmojsoski.com
	auto_https off
}

# HTTP on port 80 - Cloudflare handles TLS termination
:80 {
	# Main portfolio site
	gmojsoski.com, www.gmojsoski.com {
		encode gzip
		root * /srv/site
		file_server
	}
	
	# Analytics (GoatCounter)
	analytics.gmojsoski.com {
		encode gzip
		reverse_proxy http://172.17.0.1:8088 {
			header_up X-Forwarded-Proto https
			header_up X-Real-IP {remote_host}
		}
	}
	
	# Files (Gokapi)
	files.gmojsoski.com {
		encode gzip
		reverse_proxy http://172.17.0.1:8091 {
			header_up X-Forwarded-Proto https
			header_up X-Real-IP {remote_host}
		}
	}
	
	# Nextcloud
	cloud.gmojsoski.com {
		encode gzip
		# Security headers
		header {
			Strict-Transport-Security "max-age=15552000; includeSubDomains; preload"
		}
		reverse_proxy http://172.17.0.1:8081 {
			header_up X-Forwarded-Proto https
			header_up X-Forwarded-Host {host}
			header_up X-Forwarded-For {remote_host}
			header_up X-Real-IP {remote_host}
			header_up Host {host}
		}
	}
	
	# Bookmarks
	bookmarks.gmojsoski.com {
		encode gzip
		reverse_proxy http://172.17.0.1:5000 {
			header_up X-Forwarded-Proto https
			header_up X-Real-IP {remote_host}
		}
	}
	
	# Tickets (TravelSync)
	tickets.gmojsoski.com {
		encode gzip
		reverse_proxy http://172.17.0.1:8000 {
			header_up X-Forwarded-Proto https
			header_up X-Real-IP {remote_host}
		}
	}
	
	# Planning Poker
	poker.gmojsoski.com {
		encode gzip
		reverse_proxy http://172.17.0.1:3000 {
			header_up X-Forwarded-Proto https
			header_up X-Real-IP {remote_host}
			header_up Host {host}
			header_up X-Forwarded-Host {host}
			header_up Accept "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
		}
	}
	
	# Travelsync
	travelsync.gmojsoski.com {
		encode gzip
		reverse_proxy http://172.17.0.1:8000 {
			header_up X-Forwarded-Proto https
			header_up X-Real-IP {remote_host}
		}
	}
	
	# Vaultwarden
	vault.gmojsoski.com {
		encode gzip
		reverse_proxy http://172.17.0.1:8082 {
			header_up X-Forwarded-Proto https
			header_up X-Real-IP {remote_host}
			header_up Host {host}
			header_up X-Forwarded-Host {host}
		}
	}
	
	# Shopping (KitchenOwl)
	shopping.gmojsoski.com {
		encode gzip
		reverse_proxy http://172.17.0.1:8092 {
			header_up X-Forwarded-Proto https
			header_up X-Real-IP {remote_host}
			header_up Host {host}
			header_up X-Forwarded-Host {host}
		}
	}
	
	# Jellyfin
	jellyfin.gmojsoski.com {
		encode gzip
		reverse_proxy http://172.17.0.1:8096 {
			header_up X-Forwarded-Proto https
			header_up X-Real-IP {remote_host}
			header_up Host {host}
			header_up X-Forwarded-Host {host}
		}
	}
	
	# Default catch-all
	handle {
		encode gzip
		root * /srv/site
		file_server
	}
}
