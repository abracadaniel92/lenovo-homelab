#!/bin/bash
###############################################################################
# Setup Uptime Kuma Monitors for Caddy and Cloudflared
# Creates monitors for both local Caddy and public Cloudflared endpoint
###############################################################################

UPTIME_KUMA_URL="http://localhost:3001"
SLACK_WEBHOOK_URL="[REDACTED_SLACK_WEBHOOK]"

echo "=========================================="
echo "Uptime Kuma Monitor Setup"
echo "=========================================="
echo ""
echo "You should have TWO separate monitors:"
echo ""
echo "1. Caddy Monitor (Local)"
echo "   → Checks: http://localhost:8080"
echo "   → Purpose: Monitors if Caddy reverse proxy is running"
echo "   → This is separate from Cloudflared"
echo ""
echo "2. Cloudflared Monitor (Public)"
echo "   → Checks: https://gmojsoski.com"
echo "   → Purpose: Monitors the full chain (Cloudflare → Tunnel → Caddy → Site)"
echo "   → This is what users experience"
echo ""
echo "=========================================="
echo "Setup Instructions"
echo "=========================================="
echo ""
echo "Open Uptime Kuma: $UPTIME_KUMA_URL"
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "MONITOR 1: Caddy (Local)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "1. Click 'Add New Monitor'"
echo ""
echo "2. Configure:"
echo "   ┌─────────────────────────────────────┐"
echo "   │ Monitor Type: HTTP(s)               │"
echo "   │ Friendly Name: Caddy (Local)        │"
echo "   │ URL: http://localhost:8080         │"
echo "   │   OR: http://192.168.1.97:8080      │"
echo "   │ Interval: 60 seconds                │"
echo "   │ Retry Interval: 30 seconds          │"
echo "   │ Max Retries: 3                      │"
echo "   │ Expected Status Code: 200           │"
echo "   │                                      │"
echo "   │ Headers (optional):                 │"
echo "   │   Host: gmojsoski.com               │"
echo "   └─────────────────────────────────────┘"
echo ""
echo "3. Notify section:"
echo "   → Select your Slack notification"
echo "   → Enable: ✓ Notify When Down"
echo "   → Enable: ✓ Notify When Up (optional)"
echo ""
echo "4. Click 'Save'"
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "MONITOR 2: Cloudflared Tunnel (Public)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "1. Click 'Add New Monitor'"
echo ""
echo "2. Configure:"
echo "   ┌─────────────────────────────────────┐"
echo "   │ Monitor Type: HTTP(s) - Keyword     │"
echo "   │ Friendly Name: Cloudflared Tunnel  │"
echo "   │ URL: https://gmojsoski.com         │"
echo "   │ Interval: 60 seconds                │"
echo "   │ Retry Interval: 30 seconds         │"
echo "   │ Max Retries: 3                      │"
echo "   │ Keyword: gmojsoski                  │"
echo "   │ Expected Status Code: 200           │"
echo "   └─────────────────────────────────────┘"
echo ""
echo "3. Notify section:"
echo "   → Select your Slack notification"
echo "   → Enable: ✓ Notify When Down"
echo "   → Enable: ✓ Notify When Up (optional)"
echo ""
echo "4. Click 'Save'"
echo ""
echo "=========================================="
echo "Why Two Monitors?"
echo "=========================================="
echo ""
echo "Caddy Monitor (Local):"
echo "  • Catches Caddy-specific issues"
echo "  • Works even if Cloudflared is down"
echo "  • Helps identify if problem is Caddy vs Tunnel"
echo ""
echo "Cloudflared Monitor (Public):"
echo "  • Catches full-stack issues"
echo "  • Represents what users actually experience"
echo "  • Catches Cloudflare, Tunnel, and Caddy issues"
echo ""
echo "Both monitors can use the same Slack notification!"
echo ""
echo "=========================================="
echo "Quick Reference"
echo "=========================================="
echo ""
echo "Caddy Monitor:"
echo "  URL: http://localhost:8080"
echo "  (or http://192.168.1.97:8080 from Docker)"
echo ""
echo "Cloudflared Monitor:"
echo "  URL: https://gmojsoski.com"
echo ""
echo "Slack Webhook:"
echo "  $SLACK_WEBHOOK_URL"
echo ""
echo "Uptime Kuma:"
echo "  $UPTIME_KUMA_URL"
echo ""

